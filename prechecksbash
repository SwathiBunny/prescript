#!/bin/bash 
echo -e "#################PreWork for $HOSTNAME ####################################\n"
echo -e "===================================================================================\n"
echo -e "RPMDB Check \n"
echo -e "===================================================================================\n"
echo -e "List of Patches "
yum check-update >> /Patch_available_for_update
echo -e "===================================================================================\n"
/usr/lib/rpm/rpmdb_verify          /var/lib/rpm/Packages
echo $?
echo -e "===================================================================================\n"
echo -e "System Time \n"
uptime
echo -e "===================================================================================\n"
ll /etc/localtime
date
ntpq -p
echo -e "===================================================================================\n"
echo -e "Last Patch installed packages list \n"
echo -e "===================================================================================\n"
mkdir /patching
/bin/rpm  -qa --last >> /patching/K-patching_rpm-list_Before_patch
echo -e "===================================================================================\n"
echo -e "Kernel version before patch \n "
echo -e "===================================================================================\n"
uname -a >> /patching/before_uname-`date +"%Y-%m-%d"`
uname -a
echo -e "===================================================================================\n"
echo -e "Filesystem mounted on Servers before Patch \n"
echo -e "===================================================================================\n"
df -hPT | egrep 'ext4|xfs'
df -hPT | egrep 'ext4|xfs' | wc -l
cat /etc/fstab | egrep 'ext4|xfs'
cat /etc/fstab | egrep 'ext4|xfs' | wc -l
echo -e "===================================================================================\n"
echo -e "LVM Status \n"
echo -e "===================================================================================\n"
pvs;vgs;lvs
echo -e "===================================================================================\n"
echo -e "Ifconfig \n"
echo -e "===================================================================================\n"
/sbin/ifconfig | tee -a /patching/ifconfig > /dev/null 2>&1
ip a
echo -e "===================================================================================\n"
echo -e "Currently Running Services \n"
echo -e "===================================================================================\n"
ps -ef | grep -v root
echo -e "===================================================================================\n"
echo -e "Total Count of Process \n"
echo -e "===================================================================================\n"
ps -eaf | wc -l
echo -e "===================================================================================\n"
echo -e "Process running non root users \n"
echo -e "===================================================================================\n"
ps -eaf | grep -v root
echo -e "===================================================================================\n"
echo -e "Swap Space \n"
echo -e "===================================================================================\n"
cat /proc/swaps
swapon -s
echo -e "===================================================================================\n"
echo -e "NFS FS \n"
echo -e "===================================================================================\n"
showmount â€“e
showmount -a
echo -e "===================================================================================\n"
echo -e "Route Table \n"
echo -e "===================================================================================\n"
netstat -rn
echo -e "===================================================================================\n"
echo -e "Network config file check \n"
echo -e "===================================================================================\n"
grep -i dhcp /etc/sysconfig/network-scripts/ifcfg-*
grep IPADDR /etc/sysconfig/network-scripts/ifcfg-*
grep HWADDR /etc/sysconfig/network-scripts/ifcfg-*
echo -e "===================================================================================\n"
echo -e "Network ports are opened before patch\n"
echo -e "===================================================================================\n"
netstat -ntlp | tee -a  /patching/netstat-ntlp > /dev/null 2>&1
netstat -nr
echo -e "===================================================================================\n"
echo -e "Running the CFG2HTML \n"
echo -e "===================================================================================\n"
/usr/sbin/cfg2html -2\%Y\%m\%d > /dev/null 2>&1
echo -e "\n"
echo -e "===================================================================================\n"
sysctl -a | tee -a /patching/sysctl-a.log > /dev/null 2>&1
sysctl -p | tee -a /patching/sysctl-p.log > /dev/null 2>&1
echo -e "===================================================================================\n"
echo -e "===================================================================================\n"

echo -e "#################PreWork Completed ####################################\n"

